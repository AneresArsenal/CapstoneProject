{% extends "base.html" %} {% block content %}
<div class="jumbotron rounded-0">
    <div class="container text-center">
        <div id="jumbo-text">
            <h1 class="display-4">Menufy</h1>
            <p class="lead">{{restaurant_name}} Inventory Levels</p>
        </div>
    </div>
</div>

<div class="list-group align-items-center" style="padding-bottom: 5vh;">
    <button class="btn btn-primary" name="add-item" type="button" data-toggle="modal" data-target='#exampleModal'> Add Menu Item</button>
</div>

<div>
    <form id="business_orders_form{{restaurant_id}}" method="POST">
        <table class="table table-hover table-striped table-dark">
            <tbody id="menu">
            </tbody>
        </table>
    </form>
</div>

<!-- Modal -->
<div class="modal fade" id="itemDisplay" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
            </div>
            <div class="modal-body">
                <form id="menu_edit_form" method="POST">

                </form>
            </div>
            <div class="modal-footer">
                <a type="button" onclick="form_submit()" class="btn btn-primary" method="POST">Save changes</a>
                <button type="button" id="close" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
            </div>
            <script type="text/javascript">
                function form_submit() {
                    var menu_item_id = $('#menu_edit_form').attr('name');
                    $.ajax({
                        type: "POST",
                        url: '/business/' + menu_item_id,
                        data: $('#menu_edit_form').serialize(),
                        success: function(response) {
                            var button = document.getElementById('close');
                            button.click();
                        }
                    });
                    return false;
                }
            </script>
        </div>
    </div>
</div>

<script type="text/javascript">
    var menu_data = JSON.parse('{{ menu_data |  safe }}');

    var transform = {
        "<>": "tr",
        'id': '${menu_item_id}',
        "children": [{
            "<>": "input",
            "type": "hidden",
            'id': '${menu_item_id}',
            "name": "menu_item_id",
            "value": '${menu_item_id}'
        }, {
            "<>": "td",
            'name': 'item_name',
            "html": "${item_name}",
            "value": "${item_name}",
        }, {
            "<>": "td",
            'name': 'item_description',
            "html": "${item_description}",
            "value": "${item_description}"
        }, {
            "<>": "td",
            "html": "$ ${item_unit_price}"
        }, {
            "<>": "td",
            "html": "${item_quantity_available}"
        }, {
            "<>": "td",
            "children": [{
                '<>': 'button',
                'type': 'button',
                'class': "btn btn-primary mr-3",
                'data-toggle': "modal",
                'name': 'edit-menu',
                'value': "${item_name},${item_description},${item_unit_price},${item_quantity_available}",
                'id': '${menu_item_id}',
                'html': 'edit'
            }, {
                '<>': 'button',
                'class': "btn btn-danger",
                'type': 'button',
                'id': 'delete',
                'html': 'delete'
            }]
        }]
    };

    $('#menu').html(json2html.transform(menu_data, transform));

    $('button[name ="add-item"]').click(function() {
        // var menu_item_id = $(this).attr('id');
        // var menu_item_data = $(this).attr('value');
        // var arr = menu_item_data.split(',');
        // $(".modal-title").html("Edit Menu Item");
        // createMenuItem();
        // // document.getElementById('menu_edit_form').setAttribute("action", '/business/' + menu_item_id);
        // document.getElementById('menu_edit_form').setAttribute("name", menu_item_id);
        console.log('hello');
    });

    function createMenuItem() {
        var orderModal = $('#itemDisplay');
        $.ajax({
            type: "GET",
            url: '/business/' + menu_item_id,
            success: function(response) {
                // console.log(response);
                form_input = '';
                $.each(JSON.parse(response), function(attribute, val) {
                    // console.log(attribute, val);
                    if (attribute == 'menu_item_id') {
                        form_input += '<div class="form-group">';
                        form_input += '<label>' + attribute + '</label>';
                        form_input += '<input type="text" class="form-control" name="' + attribute + '"value="' + val + '" disabled>';
                        form_input += '</div>';
                    } else {
                        form_input += '<div class="form-group">';
                        form_input += '<label>' + attribute + '</label>';
                        form_input += '<input type="text" class="form-control" name="' + attribute + '"value="' + val + '">';
                        form_input += '</div>';
                    }

                })
                orderModal.find('#menu_edit_form').html(form_input);
                // orderModal.find('.order_result_total').html(order_total);
                orderModal.modal('show');
            }
        });
        return false;
    }


    $('button[name ="edit-menu"]').click(function() {
        var menu_item_id = $(this).attr('id');
        var menu_item_data = $(this).attr('value');
        var arr = menu_item_data.split(',');
        $(".modal-title").html("Edit Menu Item");
        var response = getMenuItem(menu_item_id);
        // document.getElementById('menu_edit_form').setAttribute("action", '/business/' + menu_item_id);
        document.getElementById('menu_edit_form').setAttribute("name", menu_item_id);
    });

    function getMenuItem(menu_item_id) {
        var orderModal = $('#itemDisplay');
        $.ajax({
            type: "GET",
            url: '/business/' + menu_item_id,
            success: function(response) {
                // console.log(response);
                form_input = '';
                $.each(JSON.parse(response), function(attribute, val) {
                    // console.log(attribute, val);
                    if (attribute == 'menu_item_id') {
                        form_input += '<div class="form-group">';
                        form_input += '<label>' + attribute + '</label>';
                        form_input += '<input type="text" class="form-control" name="' + attribute + '"value="' + val + '" disabled>';
                        form_input += '</div>';
                    } else {
                        form_input += '<div class="form-group">';
                        form_input += '<label>' + attribute + '</label>';
                        form_input += '<input type="text" class="form-control" name="' + attribute + '"value="' + val + '">';
                        form_input += '</div>';
                    }

                })
                orderModal.find('#menu_edit_form').html(form_input);
                // orderModal.find('.order_result_total').html(order_total);
                orderModal.modal('show');
            }
        });
        return false;
    }
</script>
{% endblock %}